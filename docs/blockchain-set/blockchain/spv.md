# 简单支付验证 SPV

## 什么是简单支付验证 SPV ?

简单支付验证（SPV）是一种在比特币和其他区块链网络中使用的轻量级验证方法。它允许用户在不下载整个区块链的情况下验证交易。

* **目的**：SPV旨在提供一种方式，使得用户可以验证交易而无需承担存储整个区块链的巨大负担。
* **工作原理**：SPV客户端只下载所有区块的头部信息，而不是整个区块的内容。区块头包含了足够的信息来跟踪区块链的工作量证明和最长链[1](https://zhuanlan.zhihu.com/p/46292104)。
* **Merkle树**：SPV使用Merkle树来验证特定交易是否包含在一个区块中。Merkle树是一种数据结构，它将所有交易的哈希值组织成一棵树。
* **验证过程**：当用户需要验证一个交易时，他们会从网络中获取该交易的Merkle路径。这个路径包含了从交易本身到区块头部Merkle根的一系列哈希值。通过这些信息，用户可以验证交易确实被包含在区块中。
* **安全性**：尽管SPV不如全节点安全，因为它依赖于网络中的其他节点提供信息，但它仍然提供了一定程度的安全性。SPV客户端可以检测到某些类型的双重支付攻击。
* **优点**：SPV的主要优点是它减少了存储和带宽的需求，使得在存储能力有限的设备上运行比特币客户端成为可能。
* **局限性**：SPV客户端无法完全验证交易的规则，例如交易大小或格式。因此，它们依赖于网络中的全节点来拒绝无效的交易。

简单支付验证是一种权衡，它在保持一定安全性的同时，大大降低了参与区块链网络所需的资源。这使得普通用户可以更容易地接入和使用比特币网络。

但是，即使只是存储比特币区块头，数据量也是很大的。



### 比特币的区块头如下：

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption><p>比特币区块头</p></figcaption></figure>

从图中可以看出，比特币区块头有一个默克尔根，这个根可以用于检验交易是否被包含在区块中，只需要提供交易在默克尔树中的路径上的哈希值，便可以检验交易是否存在于区块中。关于默克尔证明可以看这里。



### 流程

简单支付验证的基本流程：

1. **初始化**：SPV客户端开始时连接到网络，但不下载完整的区块链。它只需保存少量的区块头数据和相关的默克尔树。
2. **请求区块头**：SPV客户端向网络节点请求最新的区块头数据。区块头包含了每个区块的摘要信息，包括区块的哈希值、时间戳等。
3. **验证区块头**：SPV客户端验证接收到的区块头的工作量证明，确保其达到网络规定的难度要求，并检查时间戳是否合理。
4. **获取交易证据**：当SPV客户端需要验证某笔交易时，它向网络节点请求相关交易所在区块的默克尔路径证明。这个证明包含了交易所在区块的所有父节点哈希值，以及默克尔树中的对应分支。
5. **验证交易**：SPV客户端使用收到的默克尔路径证明，沿着默克尔树路径计算出根哈希，并与区块头中的默克尔树根哈希进行比较。如果匹配，就说明交易在区块中，并且得到了网络的确认。
6. **重复验证**：SPV客户端可以通过重复请求区块头和交易证据，持续地验证新的交易或者确认已有的交易。

通过这种方式，SPV客户端可以在不下载整个区块链的情况下，仍然能够验证交易的有效性，并且确保了支付的安全性和可信度。



