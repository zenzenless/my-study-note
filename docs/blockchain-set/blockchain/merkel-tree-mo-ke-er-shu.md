---
description: 默克尔证明
---

# Merkel tree 默克尔树

## 概述

默克尔树（Merkle Tree），也称为哈希树，是一种数据结构，由Ralph Merkle在1979年提出。它是一种特殊的二叉树（也可以不是二叉树），每个节点都包含一个数据块的加密哈希值。这种结构在区块链技术中非常重要，用于高效和安全地验证数据内容。以下是默克尔树的主要特点：

* **叶节点**：在默克尔树中，叶节点包含数据块（如交易）的哈希值。
* **非叶节点**：每个非叶节点包含其子节点哈希值的哈希。
* **根节点**：树的顶部是根节点，它包含了整个数据集的哈希值，称为Merkle Root。
* **验证数据**：默克尔树允许用户通过获取少量的信息来验证单个数据块是否包含在数据集中，而无需下载全部数据。
* **安全性**：由于哈希函数的特性，即使是微小的数据变化也会导致哈希值的巨大变化，因此默克尔树提供了一种安全的验证方式。
* **效率**：默克尔树提高了数据验证的效率，特别是在大型数据集中。

默克尔树在区块链中的应用包括确保数据的完整性和安全性，以及在不牺牲隐私的情况下验证交易。

## 原理如下

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption><p>默克尔树</p></figcaption></figure>

1. 将底层叶子节点的数据进行哈希计算
2. 将哈希值两两合并计算出新的哈希值
3. 新的哈希值作为父节点，再重复2步骤，直到得出根节点的哈希值







### 证明某个集合中存在或不存在某个元素

\
证明某个集合中是否存在特定元素的方法是通过构建集合的默克尔树，并提供该元素各级兄弟节点的哈希值。这种方法可以在不暴露集合完整内容的情况下进行证明。另外，对于可排序的集合，可以使用空值代替不存在的元素，构建稀疏默克尔树。这种结构可以证明某个集合中不包含指定元素。



### 快速比较大量数据

为了快速比较大量数据，可以对每组数据进行排序，然后构建默克尔树结构。当两个默克尔树的根相同时，表示两组数据相同；反之则不同。由于哈希计算速度快，预处理可以在短时间内完成。利用默克尔树结构能够带来巨大的比较性能优势。



### 应用举例

* **区块链技术**：在比特币和其他加密货币中，默克尔树用于存储交易数据。每个区块中包含了一系列交易的哈希值，这些哈希值构成了一个默克尔树。这样设计的好处是可以快速验证一笔交易是否包含在区块中，同时也确保了区块数据的完整性。
* **文件系统**：某些文件系统（如ZFS和Git）使用默克尔树来管理文件的完整性和版本控制。通过将文件分割成固定大小的块，并为每个块计算哈希值，可以有效地检测文件是否被篡改。
* **分布式数据库**：一些分布式数据库系统（如Cassandra）使用默克尔树来验证分布式数据的一致性。通过比较各个节点的默克尔树，可以检测到数据是否同步或者是否存在不一致的情况。
* **P2P网络**：在分布式系统和P2P网络中，默克尔树可以用于验证数据块的完整性。例如，在BitTorrent中，种子文件包含了默克尔树的根哈希，用于验证下载的文件是否完整和正确。



### 应用于交易所储备金证明

* [币安储备金证明](https://www.binance.com/zh-CN/proof-of-reserves)

在储备金证明验证过程中，审计机构使用密码学验证每个账户的余额是否包含在内。通过几个关键步骤即可了解其运作原理。

首先，审计机构对所有账户余额进行快照拍摄。随后将资金数据转换为[默克尔树](https://academy.binance.com/en/articles/merkle-trees-and-merkle-roots-explained)，用于构建大量数据，以便更直接地处理。&#x20;

用户余额数据经哈希处理存至“树叶”中。一组这样的“树叶”之后经哈希处理形成“树枝”，而一组“树枝”又哈希形成“树根”。

下一步，审计机构可用各种方式验证用户地址的所有权。例如，在币安平台，审计机构有三种方式能识别所有权。在交易平台运行信息提取进程时，审计机构也会对其进行验证。

* 加密信息签名：审计机构向交易平台提供一条专属信息，并使用关联私钥进行加密签名。
* 按指示转移资金：交易平台执行“按指示转移资金”任务，即管理层在特定时间从公钥/地址转移特定金额，并获得交易哈希值以验证对应区块链中按指示进行的交易。
* 在区块链浏览器中搜索地址：审计机构还可分别在[Etherscan](https://academy.binance.com/en/articles/what-is-etherscan-and-how-to-use-it)和[BscScan](https://academy.binance.com/en/articles/what-is-bscscan-and-how-to-use-it)中搜索以太坊(ETH)和币安智能链(BSC)（如在币安平台）地址，以确保地址已标记为属于该交易平台。

如经上述形式均确认为余额相符，则交易平台储备金证明验证完毕，并显示该平台全数持有所有存储资产。

